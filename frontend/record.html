<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record Your Speech - Aesop.AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-dot"></div>
                <span>Aesop.AI</span>
            </div>
            <nav class="nav">
                <a href="home.html" class="nav-link">Home</a>
                <a href="record.html" class="nav-link active">Record</a>
            </nav>
            <div class="header-actions">
                <div class="profile-btn" onclick="handleProfileClick()">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- Record Section -->
        <section id="record" class="record-section">
            <div class="record-content">
                <div class="record-instructions">
                    <h1 class="record-main-title">
                        <span class="gradient-text">Record Your Speech</span>
                    </h1>
                    <h2 class="record-subtitle">Practice and Perfect Your Communication</h2>
                    <p class="record-description">
                        Record a video of yourself speaking to prepare for transcription and analysis
                    </p>
                </div>
                
                <div class="tips-grid">
                    <div class="tip-card">
                        <div class="tip-icon">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 1C13.1 1 14 1.9 14 3V11C14 12.1 13.1 13 12 13C10.9 13 10 12.1 10 11V3C10 1.9 10.9 1 12 1Z" fill="#DC2626"/>
                                <path d="M19 10V12C19 15.9 15.9 19 12 19C8.1 19 5 15.9 5 12V10H7V12C7 14.8 9.2 17 12 17C14.8 17 17 14.8 17 12V10H19Z" fill="#DC2626"/>
                                <path d="M11 22H13V24H11V22Z" fill="#DC2626"/>
                            </svg>
                        </div>
                        <h3 class="tip-title">Speak Clearly</h3>
                        <p class="tip-description">Enunciate your words and maintain a steady pace</p>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="#DC2626" stroke-width="2" fill="none"/>
                                <circle cx="12" cy="12" r="3" fill="#DC2626"/>
                            </svg>
                        </div>
                        <h3 class="tip-title">Eye Contact</h3>
                        <p class="tip-description">Look at the camera as if speaking to a live audience</p>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" fill="#DC2626"/>
                                <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="#DC2626" stroke-width="1.5"/>
                            </svg>
                        </div>
                        <h3 class="tip-title">Confidence</h3>
                        <p class="tip-description">Maintain confident posture and body language</p>
                    </div>
                </div>

                <!-- Video Recording Interface -->
                <div class="recording-container">
                    <!-- Recording Status Indicators (Outside Video) -->
                    <div class="recording-status-bar">
                                <div class="recording-indicator hidden" id="recordingIndicator">
                                    <div class="recording-dot"></div>
                                    <span>Recording</span>
                                </div>
                                <div class="recording-timer hidden" id="recordingTimer">00:00</div>
                            </div>
                    
                    <div class="video-container">
                        <div class="video-preview" id="videoPreview">
                            <video id="webcamVideo" autoplay muted playsinline></video>
                        </div>
                        <div class="video-playback hidden" id="videoPlayback">
                            <video id="recordedVideo" controls></video>
                        </div>
                        <div class="status-text" id="statusText">Camera Preview</div>
                    </div>

                    <div class="controls-container">
                        <button class="record-button" id="recordButton" onclick="toggleRecording()">
                            <svg class="record-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 5v14l11-7z" fill="currentColor"/>
                            </svg>
                            <span class="record-text">Start Recording</span>
                        </button>

                        <div class="action-buttons">
                            <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                                <svg class="action-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2"/>
                                    <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2"/>
                                    <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" fill="none"/>
                                </svg>
                                Upload Video
                            </button>

                            <button class="download-button hidden" id="downloadButton" onclick="downloadVideo()">
                                <svg class="action-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <polyline points="7,10 12,15 17,10" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Download Video
                            </button>
                        </div>

                        <input type="file" id="fileInput" accept="video/*" style="display: none;" onchange="handleFileUpload(event)">

                        <div class="file-info hidden" id="fileInfo">
                            <h4> File Information</h4>
                            <p><strong>Video:</strong> Ready for transcription</p>
                            <p><strong>Format:</strong> WebM (VP9 codec)</p>
                            <p><strong>Audio:</strong> <span id="audioStatus">Included</span></p>
                            <p><strong>Status:</strong> Ready for analysis</p>
                        </div>

                        <div class="context-input hidden" id="contextInput">
                            <label for="speechContext" style="display: block; margin-bottom: 10px; font-weight: 600; color: #fff;">Speech Context (Optional)</label>
                            <textarea 
                                id="speechContext" 
                                placeholder="Provide context about your speech (e.g., presentation topic, audience, purpose)..." 
                                style="width: 100%; min-height: 100px; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: #fff; font-family: 'Space Grotesk', sans-serif; resize: vertical; margin-bottom: 15px;"
                            ></textarea>
                        </div>

                        <div class="preview-actions hidden" id="previewActions">
                            <button class="btn-secondary" onclick="resetRecording()">Record Another Speech</button>
                            <button class="btn-primary" onclick="uploadRecording()">Upload and Get Feedback</button>
                        </div>
                    </div>
                </div>

                <div class="upload-progress hidden" id="uploadProgress">
                    <div class="progress-spinner"></div>
                    <div class="progress-content">
                        <h3>Analyzing Your Speech</h3>
                        <p>Our AI is processing your recording and generating personalized feedback...</p>
                    </div>
                </div>

                <!-- AI Feedback Report -->
                <div id="report-content" class="report-content hidden">
                    <div class="feedback-container">
                        <!-- Box 1: Text Transcription -->
                        <div class="feedback-box transcription-box">
                            <div class="feedback-box-header">
                                <div class="transcription-header-left">
                                    <h3 class="feedback-box-title">Transcription</h3>
                                    <p class="feedback-box-subtitle">Your speech has been transcribed</p>
                                </div>
                                <button class="advice-btn" onclick="getActionableAdvice('transcriber')">
                                    <svg class="advice-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Get Actionable Advice
                                </button>
                            </div>
                            <div class="transcription-content">
                                <div class="transcription-text" id="transcriptionText">
                                    <!-- Populated dynamically from backend -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Box 2: Audio Analysis -->
                        <div class="feedback-box audio-analysis-box">
                            <div class="feedback-box-header">
                                <div class="transcription-header-left">
                                    <h3 class="feedback-box-title">Audio Analysis</h3>
                                </div>
                                <button class="advice-btn" onclick="getActionableAdvice('voice')">
                                    <svg class="advice-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Get Actionable Advice
                                </button>
                            </div>
                            <div class="audio-analysis-content">
                                <div class="audio-metrics">
                                    <div class="metric-item">
                                        <div class="metric-label">Prosody</div>
                                        <div class="metric-value" id="prosodyValue"></div>
                                        <div class="metric-score" id="prosodyScore"></div>
                                    </div>
                                    <div class="metric-item">
                                        <div class="metric-label">Tone</div>
                                        <div class="metric-value" id="toneValue"></div>
                                        <div class="metric-score" id="toneScore"></div>
                                    </div>
                                    <div class="metric-item">
                                        <div class="metric-label">Pitch</div>
                                        <div class="metric-value" id="pitchValue"></div>
                                        <div class="metric-score" id="pitchScore"></div>
                                    </div>
                                    <div class="metric-item">
                                        <div class="metric-label">Speed</div>
                                        <div class="metric-value" id="speedValue"></div>
                                        <div class="metric-score" id="speedScore"></div>
                                    </div>
                                </div>
                                <div class="audio-explanations">
                                    <div class="explanation-item">
                                        <h4 class="explanation-title">Prosody</h4>
                                        <p class="explanation-text" id="prosodyExplanation"></p>
                                    </div>
                                    <div class="explanation-item">
                                        <h4 class="explanation-title">Tone</h4>
                                        <p class="explanation-text" id="toneExplanation"></p>
                                    </div>
                                    <div class="explanation-item">
                                        <h4 class="explanation-title">Pitch</h4>
                                        <p class="explanation-text" id="pitchExplanation"></p>
                                    </div>
                                    <div class="explanation-item">
                                        <h4 class="explanation-title">Speed</h4>
                                        <p class="explanation-text" id="speedExplanation"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Box 3: Visual Analysis -->
                        <div class="feedback-box visual-analysis-box">
                            <div class="feedback-box-header">
                                <div class="transcription-header-left">
                                    <h3 class="feedback-box-title">Visual Analysis</h3>
                                </div>
                                <button class="advice-btn" onclick="getActionableAdvice('emotion')">
                                    <svg class="advice-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12 C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Get Actionable Advice
                                </button>
                            </div>
                            <div class="visual-analysis-content">
                                <!-- Top Section: Ratings and Graph -->
                                <div class="visual-top-section">
                                    <!-- Left: Emotion & Gesture Ratings -->
                                    <div class="ratings-section">
                                        <div class="rating-item">
                                            <div class="rating-label">Emotions</div>
                                            <div class="rating-value" id="emotionRating"></div>
                                            <div class="rating-description" id="emotionDescription"></div>
                                        </div>
                                        <div class="rating-item">
                                            <div class="rating-label">Gestures</div>
                                            <div class="rating-value" id="gestureRating"></div>
                                            <div class="rating-description" id="gestureDescription"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Right: Time-Emotion Graph -->
                                    <div class="graph-section">
                                        <div class="graph-header">
                                            <h4 class="graph-title">Emotional Progression</h4>
                                            <div class="legend-controls">
                                                <button class="toggle-all-btn" id="toggleAllBtn">Show All</button>
                                            </div>
                                            <div class="graph-legend">
                                                <div class="legend-item active" data-emotion="Happy">
                                                    <div class="legend-color" style="background: #F59E0B;"></div>
                                                    <span>Happy</span>
                                                </div>
                                                <div class="legend-item active" data-emotion="Angry">
                                                    <div class="legend-color" style="background: #DC2626;"></div>
                                                    <span>Angry</span>
                                                </div>
                                                <div class="legend-item active" data-emotion="Disgust">
                                                    <div class="legend-color" style="background: #10B981;"></div>
                                                    <span>Disgust</span>
                                                </div>
                                                <div class="legend-item active" data-emotion="Fear">
                                                    <div class="legend-color" style="background: #8B5CF6;"></div>
                                                    <span>Fear</span>
                                                </div>
                                                <div class="legend-item active" data-emotion="Surprise">
                                                    <div class="legend-color" style="background: #EC4899;"></div>
                                                    <span>Surprise</span>
                                                </div>
                                                <div class="legend-item active" data-emotion="Sad">
                                                    <div class="legend-color" style="background: #3B82F6;"></div>
                                                    <span>Sad</span>
                                                </div>
                                                <div class="legend-item active" data-emotion="Neutral">
                                                    <div class="legend-color" style="background: #6B7280;"></div>
                                                    <span>Neutral</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="graph-container" id="emotionGraph">
                                            <!-- Axis Labels -->
                                            <div class="axis-label y-axis-label">Emotion Intensity</div>
                                            <div class="axis-label x-axis-label">Time</div>
                                            
                                            <!-- Graph Axes -->
                                            <div class="graph-axes">
                                                <!-- Y-axis labels -->
                                                <div class="y-axis-labels">
                                                    <div class="y-label" style="top: 0%;">100%</div>
                                                    <div class="y-label" style="top: 10%;">90%</div>
                                                    <div class="y-label" style="top: 20%;">80%</div>
                                                    <div class="y-label" style="top: 30%;">70%</div>
                                                    <div class="y-label" style="top: 40%;">60%</div>
                                                    <div class="y-label" style="top: 50%;">50%</div>
                                                    <div class="y-label" style="top: 60%;">40%</div>
                                                    <div class="y-label" style="top: 70%;">30%</div>
                                                    <div class="y-label" style="top: 80%;">20%</div>
                                                    <div class="y-label" style="top: 90%;">10%</div>
                                                    <div class="y-label" style="top: 100%;">0%</div>
                                                </div>
                                                
                                                <!-- X-axis labels -->
                                                <div class="x-axis-labels">
                                                    <div class="x-label" style="left: 0%;">0</div>
                                                    <div class="x-label" style="left: 10%;">3</div>
                                                    <div class="x-label" style="left: 20%;">7</div>
                                                    <div class="x-label" style="left: 30%;">10</div>
                                                    <div class="x-label" style="left: 40%;">14</div>
                                                    <div class="x-label" style="left: 50%;">17</div>
                                                    <div class="x-label" style="left: 60%;">20</div>
                                                    <div class="x-label" style="left: 70%;">24</div>
                                                    <div class="x-label" style="left: 80%;">27</div>
                                                    <div class="x-label" style="left: 90%;">31</div>
                                                    <div class="x-label" style="left: 100%;">34</div>
                                                </div>
                                                
                                                <!-- Grid lines -->
                                                <div class="grid-lines">
                                                    <div class="grid-line horizontal" style="top: 0%;"></div>
                                                    <div class="grid-line horizontal" style="top: 10%;"></div>
                                                    <div class="grid-line horizontal" style="top: 20%;"></div>
                                                    <div class="grid-line horizontal" style="top: 30%;"></div>
                                                    <div class="grid-line horizontal" style="top: 40%;"></div>
                                                    <div class="grid-line horizontal" style="top: 50%;"></div>
                                                    <div class="grid-line horizontal" style="top: 60%;"></div>
                                                    <div class="grid-line horizontal" style="top: 70%;"></div>
                                                    <div class="grid-line horizontal" style="top: 80%;"></div>
                                                    <div class="grid-line horizontal" style="top: 90%;"></div>
                                                    <div class="grid-line horizontal" style="top: 100%;"></div>
                                                    <div class="grid-line vertical" style="left: 0%;"></div>
                                                    <div class="grid-line vertical" style="left: 10%;"></div>
                                                    <div class="grid-line vertical" style="left: 20%;"></div>
                                                    <div class="grid-line vertical" style="left: 30%;"></div>
                                                    <div class="grid-line vertical" style="left: 40%;"></div>
                                                    <div class="grid-line vertical" style="left: 50%;"></div>
                                                    <div class="grid-line vertical" style="left: 60%;"></div>
                                                    <div class="grid-line vertical" style="left: 70%;"></div>
                                                    <div class="grid-line vertical" style="left: 80%;"></div>
                                                    <div class="grid-line vertical" style="left: 90%;"></div>
                                                    <div class="grid-line vertical" style="left: 100%;"></div>
                                                </div>
                                                
                                                <!-- Emotion line graph -->
                                                <div class="emotion-line" id="emotionLine"></div>
                                                
                                                <!-- Data points -->
                                                <div class="data-points" id="dataPoints">
                                                    <!-- Populated dynamically from backend -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Bottom Section: Comprehensive Breakdown -->
                                <div class="breakdown-section">
                                    <h4 class="breakdown-title">Analysis Breakdown</h4>
                                    <div class="breakdown-content" id="breakdownContent">
                                        <div class="breakdown-item">
                                            <div class="breakdown-category">Emotional Range</div>
                                            <div class="breakdown-text" id="emotionalRangeText"></div>
                                        </div>
                                        <div class="breakdown-item">
                                            <div class="breakdown-category">Gesture Effectiveness</div>
                                            <div class="breakdown-text" id="gestureEffectivenessText"></div>
                                        </div>
                                        <div class="breakdown-item">
                                            <div class="breakdown-category">Facial Expressions</div>
                                            <div class="breakdown-text" id="facialExpressionsText"></div>
                                        </div>
                                        <div class="breakdown-item">
                                            <div class="breakdown-category">Overall Impact</div>
                                            <div class="breakdown-text" id="overallImpactText"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Actionable Advice Modal -->
    <div id="adviceModal" class="advice-modal hidden">
        <div class="advice-modal-overlay" onclick="closeAdviceModal()"></div>
        <div class="advice-modal-content">
            <div class="advice-modal-header">
                <h2 class="advice-modal-title" id="adviceModalTitle">Actionable Advice</h2>
                <button class="advice-modal-close" onclick="closeAdviceModal()">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="advice-modal-body" id="adviceModalBody">
                <div class="advice-loading">
                    <div class="spinner"></div>
                    <p>Generating personalized advice...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Footer for Record Page -->
    <footer class="record-page-footer">
        <div class="record-footer-content">
            <!-- Gray Band -->
            <div class="gray-band"></div>
            
            <div class="copyright-footer">
                <div class="copyright-content">
                    <p>&copy; 2025 Aesop.AI All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="record-script.js?t=1735689600"></script>
    <script>
        function handleProfileClick() {
            // Check if user is logged in
            const isLoggedIn = localStorage.getItem('userToken') || localStorage.getItem('isLoggedIn');
            
            if (isLoggedIn) {
                // User is logged in, go to profile page
                window.location.href = 'profile.html';
            } else {
                // User is not logged in, go to auth page
                window.location.href = 'auth.html';
            }
        }
    </script>
</body>
</html>